<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta content="IE=edge" http-equiv="X-UA-Compatible" />
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <title>Model View Controller Mechanisms — Tom Dalling</title>
    <link href="/style.css" rel="stylesheet" />
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" />
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  <link rel="canonical" href="/blog/software-design/model-view-controller-mechanisms/" /></head>

  <body>

    <div class="container">

      <div class="row">
        <div class="col-md-12">
          <nav role="navigation" class="navbar navbar-default">
            <div class="container-fluid">
              <div class="navbar-header">
                <button data-target="#bs-example-navbar-collapse-1" data-toggle="collapse" class="navbar-toggle" type="button">
                  <span class="sr-only">Toggle navigation</span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                </button>
                <a href="/" class="navbar-brand">Tom Dalling</a>
              </div>

              <div id="bs-example-navbar-collapse-1" class="collapse navbar-collapse">
                <ul class="nav navbar-nav">
                  <li><a href="/">Home</a></li>
                  <li><a href="/blog/">Blog</a></li>
                </ul>
              </div>
            </div>
          </nav>
        </div>
      </div>

      <div class="row">

        <main class="col-md-8"><article class="post post-single">
      
  <header>
    <h1><a href="/blog/software-design/model-view-controller-mechanisms/">Model View Controller Mechanisms</a></h1>
    <small class="meta">
      <span class="post-date">07 Jun, 2009</span>
      —
      Category: <a href="/blog/category/software-design/" class="category">Software Design</a>
    </small>
    
  </header>

  <div class="post-content"><p>The previous article, <a href="/software-design/model-view-controller-explained" title="Model View Controller Explained">Model View Controller Explained</a>, explained what MVC is and why it's such a good design pattern. The model view controller design pattern has a flow. Actions flow from the view to the model via certain pathways. Conversely, changes to the model flow through to the view. This article will dive into finer detail about these pathways, and discuss some of the specific mechanisms and design patterns used to implement the flows.</p>
<!--more--><h2>Observing The Model For Changes</h2><p>The model will change for a number of reasons. It will change in response to user events. It can also change based on internal events such as timers, data coming in over the network, etc. When the model changes, the view needs to be notified so it can display the new information. Watching for changes in an object is a common task, and is popularly known as "observation". There are numerous design patterns that deal with observation; all are slightly different, but have the same general purpose.</p><p>One such pattern is the "gang of four" <a href="http://en.wikipedia.org/wiki/Observer_pattern" title="Observer Pattern">Observer Pattern</a>. Here is an example of the pattern in Java:</p>
<div class="highlight"><pre><span class="c1">// Example 1</span>

<span class="kd">interface</span> <span class="nc">Observer</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">observeChange</span><span class="o">(</span><span class="n">Object</span> <span class="n">changedObject</span><span class="o">);</span>
<span class="o">}</span>

<span class="kd">interface</span> <span class="nc">Observable</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">addObserver</span><span class="o">(</span><span class="n">Observer</span> <span class="n">o</span><span class="o">);</span>
    <span class="kt">void</span> <span class="nf">removeObserver</span><span class="o">(</span><span class="n">Observer</span> <span class="n">o</span><span class="o">);</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">PersonModel</span> <span class="kd">implements</span> <span class="n">Observable</span> <span class="o">{</span>
    <span class="c1">// ... (code omitted)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">){</span>
        <span class="n">_name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
        <span class="k">for</span><span class="o">(</span><span class="n">Observer</span> <span class="n">o</span> <span class="o">:</span> <span class="n">_observers</span><span class="o">){</span>
            <span class="n">o</span><span class="o">.</span><span class="na">observeChange</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">PersonView</span> <span class="kd">implements</span> <span class="n">Observer</span> <span class="o">{</span>
    <span class="c1">// ... (code omitted)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setModel</span><span class="o">(</span><span class="n">PersonModel</span> <span class="n">pm</span><span class="o">){</span>
        <span class="n">_model</span><span class="o">.</span><span class="na">removeObserver</span><span class="o">(</span><span class="n">self</span><span class="o">);</span>
        <span class="n">_model</span> <span class="o">=</span> <span class="n">pm</span><span class="o">;</span>
        <span class="n">_model</span><span class="o">.</span><span class="na">addObserver</span><span class="o">(</span><span class="n">self</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">observeChange</span><span class="o">(</span><span class="n">Object</span> <span class="n">changedObject</span><span class="o">){</span>
        <span class="k">if</span><span class="o">(</span><span class="n">changedObject</span> <span class="o">==</span> <span class="n">_model</span><span class="o">){</span>
            <span class="k">this</span><span class="o">.</span><span class="na">updateView</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div><p>In the above example, the view knows when the model has changed because it adds itself as an observer. J2SE actually provides an <a href="http://java.sun.com/javase/6/docs/api/java/util/Observer.html" title="Observer Javadoc">Observer interface</a> and an <a href="http://java.sun.com/javase/6/docs/api/java/util/Observable.html" title="Observable Javadoc">Observable class</a> that perform the same function (but differ to the example). For brevity, the above example doesn't contain a controller, but the controller could be the <code>Observer</code> object.</p><p>One drawback is that it is difficult to tell what has actually changed in the model. Maybe only a tiny part of the view needs to be redrawn, but because view doesn't know that, it has to redraw everything which may be an expensive operation.</p><h2>Listening For Change Notifications From The Model</h2><p>Another method of observation is through notifications. Notifications are very similar to the observer pattern, but are more flexible. I really like the way notifications are handled in Cocoa, and the <a href="http://developer.apple.com/documentation/Cocoa/Conceptual/Notifications/Introduction/introNotifications.html">Cocoa documentation on notifications</a> explains notifications well.</p><p>Basically, the model object broadcasts different types of <code>Notification</code> objects, possibly to a <code>NotificationCenter</code> object. Conversely, views/controllers register to receive specific types of <code>Notification</code> objects. The model doesn't know or care about who is listening, so it doesn't have to manage a list of observers. Also, notifications can be specific enough to avoid the <em>"redraw everything whenever the tiniest change happens"</em> problem with the observer pattern.</p><p>The <code>NotificationCenter</code> can also do cool things like coalescing. Coalescing can be used to stop floods of update messages. For example, the model might be changed 5000 times in a fraction of a second. Instead of redrawing the view 5000 times, the <code>NotificationCenter</code> can coalesce all the <em>"update the view"</em> notifications into a single notification, meaning that the view is redrawn just once at the end.</p><h2>Catching User Actions With The Signal/Slot Design Pattern</h2><p>Subclassing every button and overriding <code>onClick()</code> is a tedious and unnecessary way to intercept user actions. One better (but still nasty) alternative is to tag every button with a string or a number, and have a big handling function like so:</p>
<div class="highlight"><pre><span class="c1">// Example 2</span>
<span class="kt">void</span> <span class="n">SomeWindow</span><span class="o">::</span><span class="n">handleClick</span><span class="p">(</span><span class="kt">int</span> <span class="n">buttonId</span><span class="p">){</span>
    <span class="k">switch</span><span class="p">(</span><span class="n">buttonId</span><span class="p">){</span>
        <span class="k">case</span> <span class="n">OK_BUTTON</span>: <span class="n">okClicked</span><span class="p">();</span> <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">CANCEL_BUTTON</span>: <span class="n">cancelClicked</span><span class="p">();</span> <span class="k">break</span><span class="p">;</span>
        <span class="c1">//etc.</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div><p>What we're are aiming for is something that performs the logic <em>"when button X is clicked, call function Y"</em>, and that is what the signal/slot design pattern does.</p><p>View classes emit certain signals (e.g. <em>"button was clicked"</em>, <em>"finished editing text"</em>). The controller class has certain slots (e.g. <em>"delete contact"</em>, <em>"set contact name"</em>, etc). Any signal can be hooked up to any compatible slot at run time. Signals can send arguments to slots, and a "compatible" slot is a slot that can handle the arguments. For example the "finished editing text" signal may send a single string argument, and the <em>"set contact name"</em> slot accepts a single string argument, so they are compatible.</p><p>The signal/slot pattern is easier to implement in languages with <a href="http://en.wikipedia.org/wiki/Dynamic_typing" title="Dynamic Typing">dynamic typing</a> and <a href="http://en.wikipedia.org/wiki/First-class_function" title="First-class function">first-class functions</a>, but can still be done in languages such as C++. Examples of signal/slot implementations can be seen in <a href="http://developer.apple.com/documentation/Cocoa/Conceptual/CocoaFundamentals/CommunicatingWithObjects/CommunicateWithObjects.html#//apple_ref/doc/uid/TP40002974-CH7-SW14">Cocoa's target/action mechanism</a> (Objective-C), <a href="http://www.boost.org/doc/html/signals.html" title="Boost.Signals">Boost.Signals</a> (C++), and <a href="http://doc.trolltech.com/signalsandslots.html">Qt Signals and Slots</a> (C++ and other languages).</p><h2>Catching User Actions With Delegation</h2><p>Delegation is a pattern where an object sets itself as a "delegate" of a second object. The second object calls functions on the delegate to inform it when events occur, or ask it for information. Here is an example of a possible table view delegate in Objective-C:</p>
<div class="highlight"><pre><span class="c1">// Example 3</span>
<span class="k">@implementation</span> <span class="nc">TDTableView</span>
<span class="c1">// ... (code omitted)</span>
<span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">mouseDown:</span><span class="p">(</span><span class="n">NSPoint</span><span class="p">)</span><span class="nv">point</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">rowClicked</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="n">rowAtPoint</span><span class="o">:</span><span class="n">point</span><span class="p">];</span>
    <span class="k">if</span><span class="p">(</span><span class="n">_delegate</span> <span class="o">&amp;&amp;</span> <span class="p">[</span><span class="n">_delegate</span> <span class="n">respondsToSelector</span><span class="o">:</span><span class="k">@selector</span><span class="p">(</span><span class="n">tableView</span><span class="o">:</span><span class="n">rowWasClicked</span><span class="o">:</span><span class="p">)]){</span>
        <span class="p">[</span><span class="n">_delegate</span> <span class="n">tableView</span><span class="o">:</span><span class="n">self</span> <span class="n">rowWasClicked</span><span class="o">:</span><span class="n">rowClicked</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="c1">// ... (code omitted)</span>
</pre></div><p>In the above example, the table view keeps an object <code>_delegate</code>. <code>_delegate</code> can be any class of object, which reduces the dependency between the view and whatever the delegate class is (probably the controller). When the view receives a click, if the delegate is set and the delegate has a function called <code>tableView:rowWasClicked:</code>, then that function is called on the delegate object.</p><p>Here is a way you may implement this in C++:</p>
<div class="highlight"><pre><span class="c1">// Example 4</span>
<span class="k">class</span> <span class="nc">TableViewDelegate</span> <span class="p">{</span>
    <span class="nl">public:</span>
        <span class="k">virtual</span> <span class="kt">void</span> <span class="n">tableViewRowWasClicked</span><span class="p">(</span><span class="n">TableView</span> <span class="n">tableView</span><span class="p">,</span> <span class="kt">int</span> <span class="n">rowClicked</span><span class="p">);</span>
        <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">tableViewColumnWasClicked</span><span class="p">(</span><span class="n">TableView</span> <span class="n">tableView</span><span class="p">,</span> <span class="kt">int</span> <span class="n">columnClicked</span><span class="p">);</span>
        <span class="c1">//... (more delegate functions here)</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">TableView</span> <span class="p">{</span>
    <span class="nl">private:</span>
        <span class="n">TableViewDelegate</span><span class="o">*</span> <span class="n">_delegate</span><span class="p">;</span>
    <span class="nl">public:</span>
        <span class="kt">void</span> <span class="nf">setDelegate</span><span class="p">(</span><span class="n">TableViewDelegate</span><span class="o">*</span> <span class="n">delegate</span><span class="p">);</span>
        <span class="c1">// ... (code omitted)</span>
<span class="p">};</span>

<span class="kt">void</span> <span class="n">TableView</span><span class="o">::</span><span class="n">mouseDown</span><span class="p">(</span><span class="n">Point</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">rowClicked</span> <span class="o">=</span> <span class="n">rowAtPoint</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">_delegate</span><span class="p">){</span>
        <span class="n">_delegate</span><span class="o">-&gt;</span><span class="n">tableViewRowWasClicked</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">rowClicked</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div><p>The above example uses a technique called <a href="http://en.wikipedia.org/wiki/Dependency_injection" title="Dependency injection">dependency injection</a> to decouple the TableView from it's delegate. In the MVC pattern, the delegate would be the controller object, and would therefor inherit from <code>TableViewDelegate</code>.</p><h2>Conclusion</h2><p>This article has discussed four common mechanisms used in MVC: the observer pattern, notifications, the signal/slot design pattern, and the delegation design pattern. Observation and notifications are useful for propagating changes from the model to the view, and signals/slots and delegation are used by the view to trigger changes in the model through the controller.</p></div>

  <footer>
    <div class="alert alert-info subscribe-bait">
      <p><strong>Enjoy this post?</strong></p>
      <a class="btn btn-success" href="/feed/">
        Subscribe via RSS
      </a>
      <a data-size="large" data-show-count="false" class="twitter-follow-button" href="https://twitter.com/tom_dalling">Follow @tom_dalling</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
    </div>

    <h2>Comments</h2>
    <div id="disqus_thread"></div>
    <script id="disqus_script" type="text/javascript">
      var disqus_shortname = "tomdalling";
      var disqus_identifier = "16 http:\/\/tomdalling.com\/?p=16";
      var disqus_title = "Model View Controller Mechanisms";
      var disqus_url = "http:\/\/www.tomdalling.com\/blog\/software-design\/model-view-controller-mechanisms\/";

      (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments.</a></noscript>
  </footer>

</article></main>

        <div class="col-md-4 sidebar">

          <div class="panel panel-default">
            <div class="panel-heading">Subscribe</div>
            <ul class="list-group">
              <li class="list-group-item">
                <a href="/feed/">
                  <i class="fa fa-rss"></i> RSS
                </a>
              </li>
              <li class="list-group-item">
                <a href="https://twitter.com/tom_dalling">
                  <i class="fa fa-twitter"></i> Twitter
                </a>
              </li>
            </ul>
          </div>

          <div class="panel panel-default">
            <div class="panel-heading">Recent Posts</div>
            <ul class="list-group recent-posts">
              <li class="list-group-item">
                <a href="/blog/software-design/model-view-controller-mechanisms/">Model View Controller Mechanisms</a>
              </li><li class="list-group-item">
                <a href="/blog/software-design/model-view-controller-explained/">Model View Controller Explained</a>
              </li>
            </ul>
          </div>

          <div class="panel panel-default">
            <div class="panel-heading">Blog Archives</div>
            <ul class="list-group archives">
              <li class="list-group-item">
                <a class="month" href="/blog/2009/06/">June 2009</a>
                (<span class="post-count">1</span>)
              </li><li class="list-group-item">
                <a class="month" href="/blog/2009/05/">May 2009</a>
                (<span class="post-count">1</span>)
              </li>
            </ul>
          </div>

          <div class="panel panel-default">
            <div class="panel-heading">Blog Categories</div>
            <ul class="list-group categories">
              <li class="list-group-item">
                <a class="category" href="/blog/category/software-design/">Software Design</a>
                (<span class="post-count">2</span>)
              </li>
            </ul>
          </div>

        </div>
      </div>

      <footer class="page-footer">
        <p>© 2009 – <span class="current-year">2014</span> Tom Dalling</p>

        <p class="social">
          <a href="https://twitter.com/tom_dalling">
            <i class="fa fa-lg fa-twitter"></i>
          </a>
          <a href="https://github.com/tomdalling">
            <i class="fa fa-lg fa-github"></i>
          </a>
          <a href="https://stackoverflow.com/users/108105/tom-dalling">
            <i class="fa fa-lg fa-stack-overflow"></i>
          </a>
          <a href="mailto:tom at tomdalling com">
            <i class="fa fa-lg fa-envelope"></i>
          </a>
        </p>
      </footer>

      <script src="/bundles/all.js"></script>
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-2797451-1', 'auto');
        ga('send', 'pageview');
      </script>
    </div></body>

</html>
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta content="IE=edge" http-equiv="X-UA-Compatible" />
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <title>Modern OpenGL 03 - Matrices, Depth Buffering, Animation — Tom Dalling</title>
    <link href="/style.css" rel="stylesheet" />
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" />
    <link type="text/css" rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro" />
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  <link rel="canonical" href="/blog/modern-opengl/03-matrices-depth-buffering-animation/" /></head>

  <body>

    <div class="container">

      <div class="row">
        <div class="col-md-12">
          <nav role="navigation" class="navbar navbar-default">
            <div class="container-fluid">
              <div class="navbar-header">
                <button data-target="#bs-example-navbar-collapse-1" data-toggle="collapse" class="navbar-toggle" type="button">
                  <span class="sr-only">Toggle navigation</span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                </button>
                <a href="/" class="navbar-brand">Tom Dalling</a>
              </div>

              <div id="bs-example-navbar-collapse-1" class="collapse navbar-collapse">
                <ul class="nav navbar-nav">
                  <li><a href="/">Home</a></li>
                  <li><a href="/blog/">Blog</a></li>
                </ul>
              </div>
            </div>
          </nav>
        </div>
      </div>

      <div class="row">

        <main class="col-md-8"><article class="post post-single">

  <header>
    <h1><a href="/blog/modern-opengl/03-matrices-depth-buffering-animation/">Modern OpenGL 03 - Matrices, Depth Buffering, Animation</a></h1>
    <small class="meta">
      <span class="post-date">16 Dec, 2012</span>
      —
      Category: <a href="/blog/category/modern-opengl/" class="category">Modern OpenGL Series</a>
    </small>
    <div class="main-image">
      <img class="img-responsive" src="/images/posts/modern-opengl-03/main-image.png" />
      
    </div>
  </header>

  <div class="post-content"><p>In this article, we will replace our immobile 2D triangle with a spinning 3D cube. The end result will look like this: </p><p><figure class="black">  <img src="/images/posts/modern-opengl-03/rotating-crate.gif" /> </figure></p><p>Now that we're finally getting something interesting on the screen, I can include more pictures! An album of animated gifs is available here: <a href="http://imgur.com/a/x8q7R">http://imgur.com/a/x8q7R</a></p><p>In order to make this spinning cube, we will learn a bit about matrix math, and how it is used to create perspective projections, rotation, translation, and the concept of a "camera." We will also learn about depth buffering, and why it is necessary. We will also see how a typical 3D application implements changes over time, such as animation.</p>
<!--more--><p></p><div class="modern-opengl-preamble">
  <h2>Accessing The Code</h2>

  <p>
    Download all the code as a zip from here:
    <a href="https://github.com/tomdalling/opengl-series/archive/master.zip">
      https://github.com/tomdalling/opengl-series/archive/master.zip
    </a>
  </p>

  <p>
    All the code in this series of articles is available from github:
    <a href="https://github.com/tomdalling/opengl-series">https://github.com/tomdalling/opengl-series</a>.
    You can download a zip of all the files from that page, or you can clone the
    repository if you are familiar with git.
  </p>

  <p class="builds-on-previous">
    This article builds on the code from the previous article.
  </p>

  <p>
    The code for this article can be found in the
    <a class="source_folder" href="https://github.com/tomdalling/opengl-series/tree/master/source/03_matrices">
      <code>source/03_matrices</code>
    </a>
    folder. On OS X, open the <code>opengl-series.xcodeproj</code> file in the
    root folder, and select the target that corresponds with this article. On
    Windows, open the <code>opengl-series.sln</code> file in Visual Studio 2013,
    and open the project that corresponds with this article.
  </p>

  <p>
    The project includes all of its dependencies, so you shouldn't have to
    install or configure anything extra. Please let me know if you have
    any issues compiling and running the code.
  </p>
</div><h2>Matrix Theory</h2><p>This article is mostly about using matrices in 3D, so let's start with a bit of matrix theory before getting into the code. I'm not going to focus much on the math, as there are lots of good online resources for that. We are using GLM to perform all the math for us. I will be focusing on what matrices can <em>do</em> for us in our 3D application.</p>
<blockquote class="pull-right">
  Matrices are used to transform 3D coordinates.
</blockquote><p>Matrices are used to transform 3D coordinates. Possible transformations include (click for animated example):</p>
<ul>
  <li><a href="http://en.wikipedia.org/wiki/Rotation_matrix">Rotation</a></li>
  <li><a href="http://imgur.com/a/x8q7R#6">Scaling</a> (growing and shrinking)</li>
  <li><a href="http://en.wikipedia.org/wiki/Translation_(geometry)">Translation</a> (moving)</li>
  <li><a href="http://imgur.com/a/x8q7R#0">Perspective/orthogonal projection</a> (explained later)</li>
</ul><p>A matrix is a grid/table of numbers, like this:</p><p><figure>  <img src="/images/posts/modern-opengl-03/mat4x4.png" /> </figure></p><p>The plural of matrix is "matrices" (pronounced "<a href="http://static.sfdict.com/dictstatic/dictionary/audio/luna/M02/M0208400.mp3">mey-tri-seez</a>"). For example, "I have one matrix" and "I have have two matrices."</p><p>Different numbers produce different types of transformations. The matrix above will rotate coordinates 90° around the Z axis. We will be using GLM to create our matrices, so you do not need to understand how to calculate the numbers.</p><p>Matrices can have any number of rows and columns, but for 3D transformations we need a 4×4 matrix like the one shown above. Whenever I say "matrix," I mean a 4×4 matrix.</p><p>When it comes to code, a matrix is usually represented as an array of floats. We will be using the <code>glm::mat4</code> class to represent a 4×4 matrix.</p>
<blockquote class="pull-right">
  matrix × matrix = combined matrix
</blockquote>
<blockquote class="pull-right">
  matrix × coord = transformed coord
</blockquote><p>The two most important matrix operations to understand are: </p>
<ul>
  <li>matrix × matrix = combined matrix</li>
  <li>matrix × coordinate = transformed coordinate</li>
</ul><h2>Matrix × Matrix</h2><p>When you multiply two matrices, the product is a new matrix that does <em>both</em> of the transformations.</p><p>For example, if you multiply a rotation matrix by a translation matrix, the result is a "combined" matrix that does <em>both</em> rotation <em>and</em> translation. Below is an example of this type of matrix multiplication:</p><p><figure>  <img src="/images/posts/modern-opengl-03/mat-x-mat.png" /> </figure></p>
<blockquote class="pull-right">
  Unlike normal multiplication, order is important in matrix multiplication.
</blockquote><p>Unlike normal multiplication, order is important in matrix multiplication. For example, if <code>A</code> and <code>B</code> are matrices, then <code>A &amp;times; B</code> is <strong>not</strong> necessarily equal to <code>B &amp;times; A</code>. The multiplication below is the same as the one above, but with the order changed:</p><p><figure>  <img src="/images/posts/modern-opengl-03/mat-x-mat-commutative.png" /> </figure></p><p>Notice how the result is different if the order is changed. The animations below show why order is important. They perform the same transformations, but in a different order. The transformations are: a translation up the Y axis, and a 45° rotation.</p><p><figure>  <img src="/images/posts/modern-opengl-03/rotate-translate.gif" />  <img src="/images/posts/modern-opengl-03/translate-rotate.gif" /> </figure></p><p>If, while you are coding, you see that a transformation is wrong, then go back and check that your matrix multiplication is in the correct order.</p><h2>Matrix × Coordinate</h2><p>When you multiply a matrix by a coordinate, the product is a new coordinate that has the transformation applied to it.</p><p>For example, if you take the rotation matrix above and multiply it by the coordinate (1,1,0) the result is the "transformed" coordinate (-1,1,0). The transformed coordinate is the original coordinate after being rotated 90° around the Z axis. Below is an example of this type of matrix multiplication:</p><p><figure>  <img src="/images/posts/modern-opengl-03/mat-x-vec.png" /> </figure></p><h2>Why We Use 4D Coordinates</h2><p>You will notice that the coordinates above are 4D, not 3D. They are in the format:</p><p><figure>  <img src="/images/posts/modern-opengl-03/homo-coord-letters.png" /> </figure></p>
<blockquote class="pull-right">
  We need to use 4D coordinates because 4x4 matrices *require* them in order to
  do matrix multiplication.
</blockquote><p>So why are we using 4D coordinates? Well, we require 4x4 matrices in order to do all the 3D transformations that we need. However, matrix multiplication requires that the number of columns in the left-hand side is equal to the number of rows on the right-hand side. This means that a 4x4 matrix <em>can not</em> be multiplied with a 3D coordinate, because the matrix has four columns but the coordinate only has three rows. We need to use 4D coordinates because 4x4 matrices <em>require</em> them in order to do matrix multiplication.</p><p>Some transformations, such a rotation and scaling, only require a 3x3 matrix. For those transformations, we don't need 4D coordinates because 3D will work. However, translation requires at least a 4x3 matrix, and perspective projection requires a 4x4 matrix, and we need both of those, so we are forced to use 4D.</p><p>These are called <a href="http://en.wikipedia.org/wiki/Homogeneous_coordinates">homogeneous coordinates</a>. In a later article, when we cover directional lighting, we will learn about what the 'W' dimension actually represents. At this point, however, we only need to know how to convert from 3D to 4D. When you convert a 3D coordinate into 4D, always set the 4<sup>th</sup> dimension, 'W', to 1. For example, the coordinate (22,33,44) will look like:</p><p><figure>  <img src="/images/posts/modern-opengl-03/homo-coord.png" /> </figure></p><p>When you convert a 4D coordinate back to 3D, if the 'W' dimension is still set to 1 then you can just ignore it and use the X, Y and Z values like you normally would. If you find that your 'W' value has changed to something other than 1, well… you're either doing something advanced, or you have a bug.</p><h2>Making A Cube</h2><p>The first change to the code will be to replace the triangle from the previous article with a cube. </p><p>I've made the cube out of triangles, by using two triangles on each of the six sides. In older versions of OpenGL, we could have used one square (<code>GL_QUADS</code>) per side instead of two triangles, but <code>GL_QUADS</code> have been removed from modern versions of OpenGL. The X, Y and Z coordinates will range from -1 to +1, which means the cube will be two units wide, and the center of the cube will be the origin (the origin is coordinate (0,0,0)). We will use one 256×256 texture for all sides of the cube. The data is going to be in the same format as the last article, so we won't need to change much. Here is the new data for the cube:</p>
<div class="highlight"><pre><span class="n">GLfloat</span> <span class="n">vertexData</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1">//  X     Y     Z       U     V</span>
    <span class="c1">// bottom</span>
    <span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span>   <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span>
     <span class="mf">1.0f</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span>   <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span>
    <span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span>   <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span>
     <span class="mf">1.0f</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span>   <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span>
     <span class="mf">1.0f</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span>   <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span>
    <span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span>   <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span>

    <span class="c1">// top</span>
    <span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span>   <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span>
    <span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span>   <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span>
     <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span>   <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span>
     <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span>   <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span>
    <span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span>   <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span>
     <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span>   <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span>

    <span class="c1">// front</span>
    <span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span>   <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span>
     <span class="mf">1.0f</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span>   <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span>
    <span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span>   <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span>
     <span class="mf">1.0f</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span>   <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span>
     <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span>   <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span>
    <span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span>   <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span>

    <span class="c1">// back</span>
    <span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span>   <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span>
    <span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span>   <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span>
     <span class="mf">1.0f</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span>   <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span>
     <span class="mf">1.0f</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span>   <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span>
    <span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span>   <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span>
     <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span>   <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span>

    <span class="c1">// left</span>
    <span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span>   <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span>
    <span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span>   <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span>
    <span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span>   <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span>
    <span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span>   <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span>
    <span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span>   <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span>
    <span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span>   <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span>

    <span class="c1">// right</span>
     <span class="mf">1.0f</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span>   <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span>
     <span class="mf">1.0f</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span>   <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span>
     <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span>   <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span>
     <span class="mf">1.0f</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span>   <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span>
     <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">,</span>   <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">,</span>
     <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span> <span class="mf">1.0f</span><span class="p">,</span>   <span class="mf">0.0f</span><span class="p">,</span> <span class="mf">1.0f</span>
<span class="p">};</span>
</pre></div><p>Now we need to change the call to <code>glDrawArrays</code> inside the <code>Render</code> function, because it is set to draw only the first triangle. There are six sides to a cube, each side has two triangles, and each triangle has three vertices, so the total number of vertices to draw is: 6 × 2 × 3 = 36. The new <code>glDrawArrays</code> call looks like this:</p>
<div class="highlight"><pre><span class="n">glDrawArrays</span><span class="p">(</span><span class="n">GL_TRIANGLES</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="mi">3</span><span class="p">);</span>
</pre></div><p>Lastly, we will use a different picture called "wooden-crate.jpg" as the texture. We just need to change the file name in the <code>LoadTexture</code> function, like this:</p>
<div class="highlight"><pre><span class="n">tdogl</span><span class="o">::</span><span class="n">Bitmap</span> <span class="n">bmp</span> <span class="o">=</span> <span class="n">tdogl</span><span class="o">::</span><span class="n">Bitmap</span><span class="o">::</span><span class="n">bitmapFromFile</span><span class="p">(</span><span class="n">ResourcePath</span><span class="p">(</span><span class="s">"wooden-crate.jpg"</span><span class="p">));</span>
</pre></div><p>That's it! We've provided all the data necessary to make a textured cube. If you run the program now, you will see this:</p><p><figure class="nopadding black">  <img src="/images/posts/modern-opengl-03/crate-stretched.jpg" /> </figure></p><p>At this point, we have a couple of problems. Firstly, the cube is looking awfully 2D because we can only see one side of it. We need to "move the camera" so we are looking at the cube from a different angle. Secondly, something is wrong because the width and height of the cube should be the same, but the width is obviously larger than the height in the screenshot above. In order to fix these problems, we will have to learn a bit about matrices, and how they are used in 3D applications.</p><h2>Clip Volume – The Default Camera</h2><p>To understand how to make a "camera" in 3D, we must first understand the concept of the clip volume. </p>
<blockquote class="pull-right">
  The clip volume is a cube. Whatever is <em>inside</em> the clip volume appears on
  the screen, and anything <em>outside</em> the clip volume is not visible.
</blockquote><p>The clip volume is a cube. Whatever is <em>inside</em> the clip volume appears on the screen, and anything <em>outside</em> the clip volume is not visible. It has the exact same size as the cube we made above. It ranges from -1 to +1 on the X, Y and Z axes. -X is left, +X is right, -Y is bottom, +Y is top, +Z is away from the camera, and -Z is toward the camera. </p><p>Because our cube is the exact same size as the clip volume, all we can see is the front side of the cube. </p><p>This also explains why our cube looks wider than it is tall. The window displays whatever is in the clip volume. The left and right edges of the window are -1 and +1 on the X axis, the bottom and top edges of the window are -1 and +1 on the Y axis. The clip volume gets stretched to fit the size of the viewport in the window, so our cube doesn't look square anymore.</p><h2>Moving The World While The Camera Stays Still</h2>
<blockquote class="pull-right">
  The clip volume can not be changed. It is always the same size, in the same
  position. So, instead of moving the camera, we must move the entire 3D scene
  so that it fits inside the clip volume cube correctly.
</blockquote><p>We want to make a camera that can move around, look in different directions, and maybe zoom in and out. However, the clip volume can not be changed. It is always the same size, and in the same position. So, instead of moving the camera, we must move the entire 3D scene so that it fits inside the clip volume cube correctly. For example, if we want to rotate the camera to the right, we actually rotate the whole world to the left. If we want to move the camera closer to the player, we actually move the player closer to the camera. This is how "cameras" work in 3D, they transform the entire world so that it fits into the clip volume and looks correct.</p><p>When you walk somewhere, it feels like the world is standing still, and you are moving. But you can also imagine that you are not moving at all, and the whole world is rotating underneath your feet, like you are on a treadmill. This is the difference between "moving the camera" and "moving the world." Either way, it looks exactly the same to the viewer.</p><p>So how do we transform the 3D scene to fit into the clip volume? This is where we need to use matrices.</p><h2>Implementing The Camera Matrix</h2><p>Let's implement the camera matrix first. As explained above "cameras" in 3D are just transformations that affect the whole 3D scene. Because a camera is a transformation, we can represent the camera as a matrix.</p><p>Firstly, we need to include a GLM header that will allow us to create different kinds of matrices.</p>
<div class="highlight"><pre><span class="cp">#include &lt;glm/gtc/matrix_transform.hpp&gt;</span>
</pre></div><p>Next, we need to update the vertex shader. We will make the camera matrix a variable called <code>camera</code>, and every vertex will be multiplied by the camera matrix. This is how we will transform the entire 3D scene. Every single vertex will be transformed by the camera matrix. The new vertex shader looks like this:</p>
<div class="highlight"><pre><span class="cp">#version 150</span>

<span class="n">uniform</span> <span class="n">mat4</span> <span class="n">camera</span><span class="p">;</span> <span class="c1">//this is the new variable</span>

<span class="n">in</span> <span class="n">vec3</span> <span class="n">vert</span><span class="p">;</span>
<span class="n">in</span> <span class="n">vec2</span> <span class="n">vertTexCoord</span><span class="p">;</span>

<span class="n">out</span> <span class="n">vec2</span> <span class="n">fragTexCoord</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Pass the tex coord straight through to the fragment shader</span>
    <span class="n">fragTexCoord</span> <span class="o">=</span> <span class="n">vertTexCoord</span><span class="p">;</span>
    
    <span class="c1">// Transform the input vertex with the camera matrix</span>
    <span class="n">gl_Position</span> <span class="o">=</span> <span class="n">camera</span> <span class="o">*</span> <span class="n">vec4</span><span class="p">(</span><span class="n">vert</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div><p>Now we need to set the <code>camera</code> shader variable from our C++ code. At the bottom of the <code>LoadShaders</code> function, we will add this code:</p>
<div class="highlight"><pre><span class="n">gProgram</span><span class="o">-&gt;</span><span class="n">use</span><span class="p">();</span>

<span class="n">glm</span><span class="o">::</span><span class="n">mat4</span> <span class="n">camera</span> <span class="o">=</span> <span class="n">glm</span><span class="o">::</span><span class="n">lookAt</span><span class="p">(</span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">));</span>
<span class="n">gProgram</span><span class="o">-&gt;</span><span class="n">setUniform</span><span class="p">(</span><span class="s">"camera"</span><span class="p">,</span> <span class="n">camera</span><span class="p">);</span>

<span class="n">gProgram</span><span class="o">-&gt;</span><span class="n">stopUsing</span><span class="p">();</span>
</pre></div><p>The camera matrix isn't going to change in this article, so we set it once, just after the shaders are created.</p><p>You can't set shader variables unless the shader is in use, which is why we have <code>gProgram-&gt;use()</code> and <code>gProgram-&gt;stopUsing()</code>.</p><p>We are going to use the <code>glm::lookAt</code> function to create a camera matrix for us. If you have used older versions of OpenGL, then you may have used the <code>gluLookAt</code> function to achieve the same thing, but <code>gluLookAt</code> has been removed from recent versions of OpenGL. The first argument <code>glm::vec3(3,3,3)</code> is the position of the camera. The second argument <code>glm::vec3(0,0,0)</code> is what the camera is looking at. The center of the cube is at (0,0,0) so that is where we want the camera to look. The final argument <code>glm::vec3(0,1,0)</code> is the "up" direction. We want the camera to be upright, so we set "up" to be the positive direction of the Y axis. If the camera was upside down, or tilted sideways, then this would be different.</p><p>After we've generated the camera matrix, we set the <code>camera</code> shader variable with <code>gProgram-&gt;setUniform("camera", camera);</code>. The <code>setUniform</code> method is part of the <code>tdogl::Program</code> class, and it calls <code>glUniformMatrix4fv</code> to set the shader variable.</p><p>That's it! We now have a functioning camera.</p><p>Unfortunately, if you run the program now you will see a completely black screen. This is because our camera matrix has transformed the vertices of the cube so that they are outside of the clip volume. As mentioned above, if it's outside of the clip volume then it will not be visible. To make it visible again, we need to set use a <strong>projection matrix</strong>.</p><h2>Implementing the Projection Matrix</h2><p>Remember that the clip volume is only two units wide, high, and deep. Let's say one unit is equivalent to one meter in our 3D scene. That means we can only see two meters infront of the camera, which isn't very convenient. </p><p>What we need to do is expand the clip volume so that more of the 3D scene can fit inside it. We can't change the size of the clip volume, but we can shrink the entire scene so that more of it fits into the clip volume. This shrinking is a transformation, so we can represent it as a matrix. This is basically what projection matrices are used for.</p><p>Let's update the vertex shader to add the projection matrix variable. The updated shader looks like this:</p>
<div class="highlight"><pre><span class="cp">#version 150</span>

<span class="n">uniform</span> <span class="n">mat4</span> <span class="n">projection</span><span class="p">;</span> <span class="c1">//this is the new variable</span>
<span class="n">uniform</span> <span class="n">mat4</span> <span class="n">camera</span><span class="p">;</span>

<span class="n">in</span> <span class="n">vec3</span> <span class="n">vert</span><span class="p">;</span>
<span class="n">in</span> <span class="n">vec2</span> <span class="n">vertTexCoord</span><span class="p">;</span>

<span class="n">out</span> <span class="n">vec2</span> <span class="n">fragTexCoord</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Pass the tex coord straight through to the fragment shader</span>
    <span class="n">fragTexCoord</span> <span class="o">=</span> <span class="n">vertTexCoord</span><span class="p">;</span>
    
    <span class="c1">// Apply camera and projection transformations to the vertex</span>
    <span class="n">gl_Position</span> <span class="o">=</span> <span class="n">projection</span> <span class="o">*</span> <span class="n">camera</span> <span class="o">*</span> <span class="n">vec4</span><span class="p">(</span><span class="n">vert</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
<blockquote class="pull-right">
  In matrix multiplication, the transformations are applied from right to left,
  or from closest to farthest from the vertex.
</blockquote><p>Notice the order of the matrix multiplication: <code>projection * camera * vert</code>. The camera transformation is applied first, and the projection is applied second. In matrix multiplication, the transformations are applied from right to left, or from closest to farthest from the vertex.</p><p>Now let's set the <code>projection</code> shader variable from the C++ code, the same way we did for the <code>camera</code> variable. Inside the <code>LoadShaders</code> function, add the following code just above the camera matrix code:</p>
<div class="highlight"><pre><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span> <span class="n">projection</span> <span class="o">=</span> <span class="n">glm</span><span class="o">::</span><span class="n">perspective</span><span class="p">(</span><span class="n">glm</span><span class="o">::</span><span class="n">radians</span><span class="p">(</span><span class="mf">50.0f</span><span class="p">),</span> <span class="n">SCREEN_SIZE</span><span class="p">.</span><span class="n">x</span><span class="o">/</span><span class="n">SCREEN_SIZE</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="mf">0.1f</span><span class="p">,</span> <span class="mf">10.0f</span><span class="p">);</span>
<span class="n">gProgram</span><span class="o">-&gt;</span><span class="n">setUniform</span><span class="p">(</span><span class="s">"projection"</span><span class="p">,</span> <span class="n">projection</span><span class="p">);</span>
</pre></div><p>If you have used older versions of OpenGL then you may have used <code>gluPerspective</code> to set the projection matrix, but <code>gluPerspective</code> has been removed from recent versions of OpenGL. Fortunately <code>glm::perspective</code> can be used as a replacement.</p><p>The first argument to <code>glm::perspective</code> is the "field of view" argument. This is an angle, in radians, that specifies how wide the camera's vision is. Instead of specifying radians directly, I'm using the <code>glm::radians</code> to convert 50 degrees into radians. A large field of view means the camera can see a lot of the scene, so the camera appears to be zoomed out. A small field of view means the camera can only see a small portion of the scene, so it appears to be zoomed in. The second argument is the "aspect" argument, which specifies the aspect ratio of the view. This is almost always set to <code>width/height</code> of the window. The second last argument is the "near plane." The near plane is the front of the clip volume, and the value <code>0.1</code> says that the near plane is 0.1 units away from the camera. Anything that is closer to the camera than <code>0.1</code> it will not be visible. The near plane must be a value greater than zero. The last argument is the "far plane", which is the back of the clip volume. The value <code>10.0</code> says that the camera will display everything that is within 10 units of the camera. Anything further than 10 units away will not be visible. Our cube is about three units away, so it will be visible.</p><p><code>glm::perspective</code> effectively fits a <a href="http://en.wikipedia.org/wiki/Viewing_frustum">viewing frustum</a> inside the clip volume. A frustum is like a pyramid with the top cut off. The flat base of the pyramid is the far plane. The flat part where the top has been cut off is the near plane. The field of view is the skinniness or fatness of the frustum. Anything inside the frustum will be displayed on the screen, and anything outside will be hidden.</p><p><figure>  <img src="/images/posts/modern-opengl-03/frustum.png" />  <figcaption>  A viewing frustum. Image by <a href="http://commons.wikimedia.org/wiki/File:Frustum_clipping.svg">Tetromino</a>.  </figcaption> </figure></p><p>With the combination of the camera matrix and the projection matrix, we should be able to see the cube now. If you run the program at this point you will see this:</p><p><figure class="nopadding black">  <img src="/images/posts/modern-opengl-03/depth-buffer-disabled.png" /> </figure></p><p>That looks… almost correct.</p><p>The cube looks square now, instead of rectangular. This is because of the "aspect" argument of the call to <code>glm::perspective</code>, which corrects the aspect ratio based on the width and height of the window.</p><p>Unfortunately, the screenshot above shows that some of the back sides of the cube are being rendered <em>over the top</em> of the front sides. We obviously don't want this to happen, so we will enable <strong>depth buffering</strong> to fix the problem.</p><h2>Depth Buffering</h2>
<blockquote class="pull-right">
  Depth buffering is one way to stop things in the background from being drawn
  over the top of things in the foreground.
</blockquote><p>By default, OpenGL draws over the top of whatever was previously drawn. If the back side of an object is drawn after the front, then the back will be drawn over the top of the front. Depth buffering is one way to stop things in the background from being drawn over the top of things in the foreground.</p>
<blockquote class="pull-right">
  A preexisting pixel only gets overwritten if the new pixel is closer to the
  camera.
</blockquote><p>With depth buffering enabled, every pixel that is drawn knows how far away from the camera it is. It stores this distance as a number in the "depth buffer." When you draw a pixel over an existing pixel, OpenGL will look at the depth buffer to determine which pixel is closer to the camera. If the new pixel being drawn is closer to the camera, it will overwrite the existing pixel. If the preexisting pixel is closer to the camera, then the new pixel being drawn is <em>discarded</em>. That is, a preexisting pixel only gets overwritten if the new pixel is closer to the camera. This is called "depth testing."</p><h2>Implementing Depth Buffering</h2><p>Inside the <code>AppMain</code> function, after the call to <code>glewInit</code>, we add this code:</p>
<div class="highlight"><pre><span class="n">glEnable</span><span class="p">(</span><span class="n">GL_DEPTH_TEST</span><span class="p">);</span>
<span class="n">glDepthFunc</span><span class="p">(</span><span class="n">GL_LESS</span><span class="p">);</span>
</pre></div><p>This tells OpenGL to enable depth testing. The <code>glDepthFunc</code> call says that pixels should be overwritten if the distance to the camera is <em>less</em> than the existing pixel's distance.</p><p>The last step is to clear the depth buffer every time we render a new frame. If we didn't do this then the old pixel distances would stay in the buffer, which would ruin the rendering of the new frame. Inside the <code>Render</code> function we change the <code>glClear</code> call to this:</p>
<div class="highlight"><pre><span class="n">glClear</span><span class="p">(</span><span class="n">GL_COLOR_BUFFER_BIT</span> <span class="o">|</span> <span class="n">GL_DEPTH_BUFFER_BIT</span><span class="p">);</span>
</pre></div><p>Finally, with depth buffering enabled, if you run the program the cube will be rendered correctly:</p><p><figure class="nopadding black">  <img src="/images/posts/modern-opengl-03/depth-buffer-correct.png" /> </figure></p><h2>Rotating The Cube</h2><p>Congratulations if you've made it this far! The final thing to implement is the spinning animation of the cube.</p><p>How are we going to implement the spinning? You guessed it: another matrix. The difference between this matrix and the others is that this matrix will change every frame. The other matrices are constant.</p><p>I'm going to call this new matrix the "model" matrix. In a normal 3D engine, each object has a different model matrix. The camera and the projection matrices are the same for the whole scene, but the model matrices are different for each object in the scene. The model matrix is used to put each object in the correct position (translation), to make the object face the correct direction (rotation), and to change the size of the object (scaling). We only have one object in our 3D scene, though, so we only have one model matrix.</p><p>Let's add a <code>model</code> matrix variable to the vertex shader, like we did for the camera and projection. The final version of the vertex shader looks like this:</p>
<div class="highlight"><pre><span class="cp">#version 150</span>

<span class="n">uniform</span> <span class="n">mat4</span> <span class="n">projection</span><span class="p">;</span>
<span class="n">uniform</span> <span class="n">mat4</span> <span class="n">camera</span><span class="p">;</span>
<span class="n">uniform</span> <span class="n">mat4</span> <span class="n">model</span><span class="p">;</span> <span class="c1">//this is the new variable</span>

<span class="n">in</span> <span class="n">vec3</span> <span class="n">vert</span><span class="p">;</span>
<span class="n">in</span> <span class="n">vec2</span> <span class="n">vertTexCoord</span><span class="p">;</span>

<span class="n">out</span> <span class="n">vec2</span> <span class="n">fragTexCoord</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Pass the tex coord straight through to the fragment shader</span>
    <span class="n">fragTexCoord</span> <span class="o">=</span> <span class="n">vertTexCoord</span><span class="p">;</span>
    
    <span class="c1">// Apply all matrix transformations to vert</span>
    <span class="n">gl_Position</span> <span class="o">=</span> <span class="n">projection</span> <span class="o">*</span> <span class="n">camera</span> <span class="o">*</span> <span class="n">model</span> <span class="o">*</span> <span class="n">vec4</span><span class="p">(</span><span class="n">vert</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div><p>Notice the order of the matrix multiplication. The model matrix is the closest one to the <code>vert</code> variable, which means the model matrix will be applied first, then the camera, and lastly the projection.</p><p>Now we need to set the new <code>model</code> shader variable. Unlike the camera and projection variables, the model variable needs to be set every frame, so we will set it inside the <code>Render</code> function. Just after the call to <code>gProgram-&gt;use()</code> add this code:</p>
<div class="highlight"><pre><span class="n">gProgram</span><span class="o">-&gt;</span><span class="n">setUniform</span><span class="p">(</span><span class="s">"model"</span><span class="p">,</span> <span class="n">glm</span><span class="o">::</span><span class="n">rotate</span><span class="p">(</span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="p">(),</span> <span class="n">glm</span><span class="o">::</span><span class="n">radians</span><span class="p">(</span><span class="mf">45.0f</span><span class="p">),</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)));</span>
</pre></div><p>We are using the <code>glm::rotate</code> function to create a rotation transformation matrix. The first argument is an existing matrix to combine with the rotation matrix. We don't have an existing matrix to combine, so we just pass in a new <code>glm::mat4</code> object. The next argument is the angle of the rotation, or how <em>much</em> to rotate. Let's just set this to a constant 45° for now. The last argument is the axis of the rotation. Imagine rotation as stabbing a skewer through an object, and then twisting the skewer. The skewer is the axis, and the angle is how much you twist it. In our case, we will use a vertical skewer, so the cube will rotate like it is sitting on a flat table.</p><p>If you run the program now, you will see that the cube has been rotated:</p><p><figure class="nopadding black">  <img src="/images/posts/modern-opengl-03/not-animated.png" /> </figure></p><p>It isn't spinning yet, because the matrix doesn't change – it is always set to rotate 45°. The last step is the change the rotation angle a little bit every frame.</p><h2>Animation</h2><p>First, let's add a new global called <code>gDegreesRotated</code>.</p>
<div class="highlight"><pre><span class="n">GLfloat</span> <span class="n">gDegreesRotated</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
</pre></div><p>Every frame, we will slightly increase <code>gDegreesRotated</code>, and then we will use it to calculate a new rotation matrix. This is how we will achieve animation. What we want to do is update, draw, update, draw, update, draw, in that pattern.</p><p>Let's make a function called <code>Update</code> that will slightly increase the <code>gDegreesRotated</code> every time it is called:</p>
<div class="highlight"><pre><span class="kt">void</span> <span class="nf">Update</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">//rotate by 1 degree</span>
    <span class="n">gDegreesRotated</span> <span class="o">+=</span> <span class="mf">1.0f</span><span class="p">;</span>

    <span class="c1">//don't go over 360 degrees</span>
    <span class="k">while</span><span class="p">(</span><span class="n">gDegreesRotated</span> <span class="o">&gt;</span> <span class="mf">360.0f</span><span class="p">)</span> <span class="n">gDegreesRotated</span> <span class="o">-=</span> <span class="mf">360.0f</span><span class="p">;</span>
<span class="p">}</span> 
</pre></div><p>Now we need to call the <code>Update</code> function every time we draw a new frame. Let's add it to the loop in <code>AppMain</code>, just before the call to <code>Render</code>.</p>
<div class="highlight"><pre><span class="k">while</span><span class="p">(</span><span class="n">glfwGetWindowParam</span><span class="p">(</span><span class="n">GLFW_OPENED</span><span class="p">)){</span>
    <span class="c1">// process pending events</span>
    <span class="n">glfwPollEvents</span><span class="p">();</span>

    <span class="c1">// update the rotation animation</span>
    <span class="n">Update</span><span class="p">();</span>
    
    <span class="c1">// draw one frame</span>
    <span class="n">Render</span><span class="p">();</span>
<span class="p">}</span>
</pre></div><p>Now we just have to recalculate the model matrix based on the <code>gDegreesRotated</code> variable. Inside the <code>Render</code> function we'll modify the code to set the model matrix:</p>
<div class="highlight"><pre><span class="n">gProgram</span><span class="o">-&gt;</span><span class="n">setUniform</span><span class="p">(</span><span class="s">"model"</span><span class="p">,</span> <span class="n">glm</span><span class="o">::</span><span class="n">rotate</span><span class="p">(</span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="p">(),</span> <span class="n">glm</span><span class="o">::</span><span class="n">radians</span><span class="p">(</span><span class="n">gDegreesRotated</span><span class="p">),</span> <span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)));</span>
</pre></div><p>The only difference is that we are using the variable <code>gDegreesRotated</code> instead of a constant 45°.</p><p>If you run the program now you should see a nice, smooth spinning animation of the cube. The only problem is that the spinning speed is tied to how many frames per second (FPS) we can render. If the FPS goes up, then the cube spins faster. If the FPS goes down, the cube spins more slowly. This isn't ideal. A program should update correctly regardless of how many FPS it is running at.</p><h2>Time-based Animation</h2><p>To make the program run correctly, independent of FPS, the animation should be updated <em>per second</em>, not <em>per frame</em>. The simplest way to do this is to count the number of seconds elapsed since the last update, and update accordingly. Let's change the <code>Update</code> function so that it takes an argument called <code>secondsElapsed</code>:</p>
<div class="highlight"><pre><span class="kt">void</span> <span class="nf">Update</span><span class="p">(</span><span class="kt">float</span> <span class="n">secondsElapsed</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">const</span> <span class="n">GLfloat</span> <span class="n">degreesPerSecond</span> <span class="o">=</span> <span class="mf">180.0f</span><span class="p">;</span>
    <span class="n">gDegreesRotated</span> <span class="o">+=</span> <span class="n">secondsElapsed</span> <span class="o">*</span> <span class="n">degreesPerSecond</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="n">gDegreesRotated</span> <span class="o">&gt;</span> <span class="mf">360.0f</span><span class="p">)</span> <span class="n">gDegreesRotated</span> <span class="o">-=</span> <span class="mf">360.0f</span><span class="p">;</span>
<span class="p">}</span>
</pre></div><p>This will make the cube spin at a constant 180° per second, no matter what the frame rate is.</p><p>In the <code>AppMain</code> loop, we need to calculate how many seconds have elapsed since the last update. The new loop looks like this:</p>
<div class="highlight"><pre><span class="kt">double</span> <span class="n">lastTime</span> <span class="o">=</span> <span class="n">glfwGetTime</span><span class="p">();</span>
<span class="k">while</span><span class="p">(</span><span class="n">glfwGetWindowParam</span><span class="p">(</span><span class="n">GLFW_OPENED</span><span class="p">)){</span>
    <span class="c1">// process pending events</span>
    <span class="n">glfwPollEvents</span><span class="p">();</span>

    <span class="c1">// update the scene based on the time elapsed since last update</span>
    <span class="kt">double</span> <span class="n">thisTime</span> <span class="o">=</span> <span class="n">glfwGetTime</span><span class="p">();</span>
    <span class="n">Update</span><span class="p">((</span><span class="kt">float</span><span class="p">)(</span><span class="n">thisTime</span> <span class="o">-</span> <span class="n">lastTime</span><span class="p">));</span>
    <span class="n">lastTime</span> <span class="o">=</span> <span class="n">thisTime</span><span class="p">;</span>
    
    <span class="c1">// draw one frame</span>
    <span class="n">Render</span><span class="p">();</span>
<span class="p">}</span>
</pre></div><p><code>glfwGetTime</code> returns the number of seconds elapsed since the program started running.</p><p>We use a variable called <code>lastTime</code> to remember when the last update happened. Each iteration of the loop, we get the current time in the variable <code>thisTime</code>. The time elapsed since the last update is <code>thisTime - lastTime</code>. After the update is finished, we set <code>lastTime = thisTime</code> so that the next iteration through the loop will work.</p><p>This is a simple way to update based on time. There is <a href="http://gafferongames.com/game-physics/fix-your-timestep/">a better way to do time-based updates</a>, but it is more complicated and we don't need it yet.</p><h2>Future Article Sneak Peek</h2><p>In the next article we will be make the <code>tdogl::Camera</code> class, which will allow us to have a first-person-shooter-style camera that can move around with the keyboard, look in different directions with the mouse, and zoom in and out with the mouse wheel.</p><h2>Additional Resources</h2>
<ul>
  <li><a href="http://www.opengl-tutorial.org/beginners-tutorials/tutorial-3-matrices/">Tutorial 3 : Matrices</a> is a great explanation of matrices from opengl-tutorial.org</li>
  <li><a href="http://en.wikipedia.org/wiki/Scaling_(geometry)">Scaling</a>, <a href="http://en.wikipedia.org/wiki/Rotation_matrix">rotation</a>, <a href="http://en.wikipedia.org/wiki/Translation_(geometry)">translation</a>, and <a href="http://en.wikipedia.org/wiki/Transformation_matrix">transformation matrices</a> on Wikipedia</li>
  <li><a href="http://www.matrix44.net/cms/notes/opengl-3d-graphics/basic-3d-math-matrices">Basic 3D Math: Matrices</a></li>
  <li><a href="http://www.teamten.com/lawrence/graphics/homogeneous/">Homogeneous coordinates</a> by Lawrence Kesteloot</li>
  <li><a href="http://www.glprogramming.com/red/chapter03.html">Viewing</a> chapter of the OpenGL red book. Uses old version of OpenGL in code examples, but the theory is still the same.</li>
  <li>GLM <a href="http://glm.g-truc.net/code.html">code samples</a> and<a href="http://glm.g-truc.net/glm-0.9.4.pdf">manual (pdf)</a></li>
  <li><a href="http://en.wikipedia.org/wiki/Z-buffering">Z-buffering (depth buffering)</a> on Wikipedia</li>
  <li><a href="http://www.arcsynthesis.org/gltut/Positioning/Tut05%20Overlap%20and%20Depth%20Buffering.html">Overlap and Depth Buffering</a> section of the Learning Modern 3D Graphics Programming book</li>
  <li><a href="http://gafferongames.com/game-physics/fix-your-timestep/">Fix Your Timestep!</a> by Glenn Fiedler</li>
</ul></div>

  <footer>
    <div class="alert alert-info subscribe-bait">
      <p><strong>Enjoy this post?</strong></p>
      <a class="btn btn-success" href="/feed/">
        Subscribe via RSS
      </a>
      <a data-size="large" data-show-count="false" class="twitter-follow-button" href="https://twitter.com/tom_dalling">Follow @tom_dalling</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
    </div>

<div class="row programming-for-beginners-book">
  <div class="col-md-12">
    <div class="panel panel-default">
      <div class="panel-body">
        <div class="col-md-6">
          <a href="https://leanpub.com/programming-for-beginners">
            <img class="img-responsive" src="/images/programming-for-beginners-cover.png" />
          </a>
        </div>
        <div class="col-md-6">
          <span class="h1">
            Programming for Beginners
            <small>Learn to Code by Making Little Games</small>
          </span>
          <p>Take your first step into the world of computer programming. This
          book assumes that you don't know anything about writing code, and
          teaches you the fundamental concepts that programmers use every day.
          You will need some basic computer skills – like downloading, opening,
          and saving files – but everything else will be explained here, step
          by step, starting from the very beginning.</p>
          <a class="btn btn-lg btn-primary" href="https://leanpub.com/programming-for-beginners">
            View on Leanpub
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

    <h2>Comments</h2>
    <div id="disqus_thread"></div>
    <script id="disqus_script" type="text/javascript">
      var disqus_shortname = "tomdalling";
      var disqus_identifier = "879 http:\/\/tomdalling.com\/?p=879";
      var disqus_title = "Modern OpenGL 03 - Matrices, Depth Buffering, Animation";
      var disqus_url = "http:\/\/www.tomdalling.com\/blog\/modern-opengl\/03-matrices-depth-buffering-animation\/";

      (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments.</a></noscript>
  </footer>

</article></main>

        <div class="col-md-4 sidebar">

          <div class="panel panel-default">
            <div class="panel-heading">Subscribe</div>
            <ul class="list-group">
              <li class="list-group-item">
                <a href="/blog/feed/">
                  <i class="fa fa-rss"></i> RSS
                </a>
              </li>
              <li class="list-group-item">
                <a href="https://twitter.com/tom_dalling">
                  <i class="fa fa-twitter"></i> Twitter
                </a>
              </li>
            </ul>
          </div>

          <div class="panel panel-default">
            <div class="panel-heading">Recent Posts</div>
            <ul class="list-group recent-posts">
              <li class="list-group-item">
                <a href="/blog/software-design/fizzbuzz-in-too-much-detail/">FizzBuzz In Too Much Detail</a>
              </li><li class="list-group-item">
                <a href="/blog/ruby/fruity-bat-flappy-bird-clone-in-ruby/">Making Fruity Bat (a Flappy Bird clone) in Ruby</a>
              </li><li class="list-group-item">
                <a href="/blog/modern-opengl/08-even-more-lighting-directional-lights-spotlights-multiple-lights/">Modern OpenGL 08 – Even More Lighting: Directional Lights, Spotlights, &amp; Multiple Lights</a>
              </li><li class="list-group-item">
                <a href="/blog/modern-opengl/opengl-in-2014/">OpenGL in 2014</a>
              </li><li class="list-group-item">
                <a href="/blog/modern-opengl/explaining-homogenous-coordinates-and-projective-geometry/">Explaining Homogeneous Coordinates &amp; Projective Geometry</a>
              </li>
            </ul>
          </div>

          <div class="panel panel-default">
            <div class="panel-heading">Blog Categories</div>
            <ul class="list-group categories">
              <li class="list-group-item">
                <a class="category" href="/blog/category/cocoa/">Cocoa</a>
                (<span class="post-count">5</span>
                <a href="/blog/category/cocoa/feed/" class="feed"><i class="fa fa-rss"></i></a>)
              </li><li class="list-group-item">
                <a class="category" href="/blog/category/coding-styleconventions/">Coding Style/Conventions</a>
                (<span class="post-count">3</span>
                <a href="/blog/category/coding-styleconventions/feed/" class="feed"><i class="fa fa-rss"></i></a>)
              </li><li class="list-group-item">
                <a class="category" href="/blog/category/coding-tips/">Coding Tips</a>
                (<span class="post-count">4</span>
                <a href="/blog/category/coding-tips/feed/" class="feed"><i class="fa fa-rss"></i></a>)
              </li><li class="list-group-item">
                <a class="category" href="/blog/category/random-stuff/">Miscellaneous</a>
                (<span class="post-count">1</span>
                <a href="/blog/category/random-stuff/feed/" class="feed"><i class="fa fa-rss"></i></a>)
              </li><li class="list-group-item">
                <a class="category" href="/blog/category/modern-opengl/">Modern OpenGL Series</a>
                (<span class="post-count">10</span>
                <a href="/blog/category/modern-opengl/feed/" class="feed"><i class="fa fa-rss"></i></a>)
              </li><li class="list-group-item">
                <a class="category" href="/blog/category/ruby/">Ruby</a>
                (<span class="post-count">1</span>
                <a href="/blog/category/ruby/feed/" class="feed"><i class="fa fa-rss"></i></a>)
              </li><li class="list-group-item">
                <a class="category" href="/blog/category/software-design/">Software Design</a>
                (<span class="post-count">9</span>
                <a href="/blog/category/software-design/feed/" class="feed"><i class="fa fa-rss"></i></a>)
              </li><li class="list-group-item">
                <a class="category" href="/blog/category/software-processes/">Software Processes</a>
                (<span class="post-count">1</span>
                <a href="/blog/category/software-processes/feed/" class="feed"><i class="fa fa-rss"></i></a>)
              </li><li class="list-group-item">
                <a class="category" href="/blog/category/web/">Web</a>
                (<span class="post-count">1</span>
                <a href="/blog/category/web/feed/" class="feed"><i class="fa fa-rss"></i></a>)
              </li>
            </ul>
          </div>

          <div class="panel panel-default">
            <div class="panel-heading">Blog Archives</div>
            <ul class="list-group archives">
              <li class="list-group-item">
                <a class="month" href="/blog/2015/04/">April 2015</a>
                (<span class="post-count">1</span>)
              </li><li class="list-group-item">
                <a class="month" href="/blog/2015/02/">February 2015</a>
                (<span class="post-count">1</span>)
              </li><li class="list-group-item">
                <a class="month" href="/blog/2014/11/">November 2014</a>
                (<span class="post-count">1</span>)
              </li><li class="list-group-item">
                <a class="month" href="/blog/2014/09/">September 2014</a>
                (<span class="post-count">1</span>)
              </li><li class="list-group-item">
                <a class="month" href="/blog/2014/02/">February 2014</a>
                (<span class="post-count">1</span>)
              </li><li class="list-group-item">
                <a class="month" href="/blog/2013/04/">April 2013</a>
                (<span class="post-count">1</span>)
              </li><li class="list-group-item">
                <a class="month" href="/blog/2013/03/">March 2013</a>
                (<span class="post-count">1</span>)
              </li><li class="list-group-item">
                <a class="month" href="/blog/2013/02/">February 2013</a>
                (<span class="post-count">1</span>)
              </li><li class="list-group-item">
                <a class="month" href="/blog/2013/01/">January 2013</a>
                (<span class="post-count">2</span>)
              </li><li class="list-group-item">
                <a class="month" href="/blog/2012/12/">December 2012</a>
                (<span class="post-count">2</span>)
              </li><li class="list-group-item">
                <a class="month" href="/blog/2012/11/">November 2012</a>
                (<span class="post-count">2</span>)
              </li><li class="list-group-item">
                <a class="month" href="/blog/2012/07/">July 2012</a>
                (<span class="post-count">2</span>)
              </li><li class="list-group-item">
                <a class="month" href="/blog/2012/05/">May 2012</a>
                (<span class="post-count">2</span>)
              </li><li class="list-group-item">
                <a class="month" href="/blog/2012/03/">March 2012</a>
                (<span class="post-count">2</span>)
              </li><li class="list-group-item">
                <a class="month" href="/blog/2011/12/">December 2011</a>
                (<span class="post-count">1</span>)
              </li><li class="list-group-item">
                <a class="month" href="/blog/2010/12/">December 2010</a>
                (<span class="post-count">1</span>)
              </li><li class="list-group-item">
                <a class="month" href="/blog/2010/11/">November 2010</a>
                (<span class="post-count">1</span>)
              </li><li class="list-group-item">
                <a class="month" href="/blog/2010/05/">May 2010</a>
                (<span class="post-count">1</span>)
              </li><li class="list-group-item">
                <a class="month" href="/blog/2010/04/">April 2010</a>
                (<span class="post-count">1</span>)
              </li><li class="list-group-item">
                <a class="month" href="/blog/2010/02/">February 2010</a>
                (<span class="post-count">1</span>)
              </li><li class="list-group-item">
                <a class="month" href="/blog/2009/12/">December 2009</a>
                (<span class="post-count">1</span>)
              </li><li class="list-group-item">
                <a class="month" href="/blog/2009/11/">November 2009</a>
                (<span class="post-count">3</span>)
              </li><li class="list-group-item">
                <a class="month" href="/blog/2009/10/">October 2009</a>
                (<span class="post-count">2</span>)
              </li><li class="list-group-item">
                <a class="month" href="/blog/2009/07/">July 2009</a>
                (<span class="post-count">1</span>)
              </li><li class="list-group-item">
                <a class="month" href="/blog/2009/06/">June 2009</a>
                (<span class="post-count">1</span>)
              </li><li class="list-group-item">
                <a class="month" href="/blog/2009/05/">May 2009</a>
                (<span class="post-count">1</span>)
              </li>
            </ul>
          </div>

        </div>
      </div>

      <footer class="page-footer">
        <p>© 2009 – <span class="current-year">2015</span> Tom Dalling</p>

        <p class="social">
          <a href="https://twitter.com/tom_dalling">
            <i class="fa fa-lg fa-twitter"></i>
          </a>
          <a href="https://github.com/tomdalling">
            <i class="fa fa-lg fa-github"></i>
          </a>
          <a href="https://stackoverflow.com/users/108105/tom-dalling">
            <i class="fa fa-lg fa-stack-overflow"></i>
          </a>
          <a href="mailto:tom at tomdalling com">
            <i class="fa fa-lg fa-envelope"></i>
          </a>
        </p>
      </footer>

      <script src="/bundles/all.js"></script>
      <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [['$$','$$']],
            displayMath: [['[blockmath]', '[/blockmath]']]
          }
        });
      </script>
      <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </div></body>

</html>